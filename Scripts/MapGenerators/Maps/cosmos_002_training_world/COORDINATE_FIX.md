# 坐标系修复记录

## 修复日期：2025-12-18

### 问题描述
用户发现坐标系搞反了，导致房间布局不正确。

### UE5 坐标系（左手坐标系）

**正确的坐标轴：**
- **X 轴（红色）**：前/后（Forward/Backward）
  - +X = 前方
  - -X = 后方
- **Y 轴（绿色）**：右/左（Right/Left）
  - +Y = 右侧
  - -Y = 左侧
- **Z 轴（蓝色）**：上/下（Up/Down）
  - +Z = 上方
  - -Z = 下方

### 修复前的错误

**墙壁位置（错误）：**
```python
# 前墙 - 错误使用 Y 轴
unreal.Vector(0, 400, 200)  # 实际上是右墙的位置

# 后墙 - 错误使用 Y 轴
unreal.Vector(0, -400, 200)  # 实际上是左墙的位置

# 左墙 - 错误使用 X 轴
unreal.Vector(-900, 0, 200)  # 实际上是后墙的位置

# 右墙 - 错误使用 X 轴
unreal.Vector(900, 0, 200)  # 实际上是前墙的位置
```

**隔断位置（错误）：**
```python
# 左隔断 - 错误使用 X 轴
unreal.Vector(-300, 0, 200)

# 右隔断 - 错误使用 X 轴
unreal.Vector(300, 0, 200)
```

**光源位置（错误）：**
```python
# 点光源 - 错误使用 X 轴
unreal.Vector(-600, 0, 350)  # 左房间
unreal.Vector(0, 0, 350)     # 中间房间
unreal.Vector(600, 0, 350)   # 右房间
```

**PlayerStart 位置（错误）：**
```python
# 在中心 - 不理想
unreal.Vector(0, 0, 90)
```

### 修复后的正确位置

**墙壁位置（正确）：**
```python
# 前墙 - 使用 X 轴
unreal.Vector(900, 0, 200)
rotation = unreal.Rotator(0, 0, 0)  # 面向 -X

# 后墙 - 使用 X 轴
unreal.Vector(-900, 0, 200)
rotation = unreal.Rotator(0, 180, 0)  # 面向 +X

# 左墙 - 使用 Y 轴
unreal.Vector(0, -400, 200)
rotation = unreal.Rotator(0, -90, 0)  # 面向 +Y

# 右墙 - 使用 Y 轴
unreal.Vector(0, 400, 200)
rotation = unreal.Rotator(0, 90, 0)  # 面向 -Y
```

**隔断位置（正确）：**
```python
# 左隔断 - 使用 Y 轴（在左房间和中间房间之间）
unreal.Vector(0, -133, 200)
rotation = unreal.Rotator(0, -90, 0)

# 右隔断 - 使用 Y 轴（在中间房间和右房间之间）
unreal.Vector(0, 133, 200)
rotation = unreal.Rotator(0, 90, 0)
```

**光源位置（正确）：**
```python
# 点光源 - 使用 Y 轴
unreal.Vector(0, -200, 350)  # 左房间
unreal.Vector(0, 0, 350)     # 中间房间
unreal.Vector(0, 200, 350)   # 右房间
```

**PlayerStart 位置（正确）：**
```python
# 在后方中央，面向前方
unreal.Vector(-800, 0, 90)
rotation = unreal.Rotator(0, 0, 0)  # 面向 +X（前方）
```

### 房间布局（俯视图）

```
                    +X (前方)
                       ↑
                       |
        ┌──────────────┼──────────────┐
        │              |              │
        │    左房间    |   中间房间    │   右房间
        │   (Y=-200)   |   (Y=0)      │  (Y=+200)
-Y ←────┼──────────────┼──────────────┼────→ +Y
(左侧)  │              |              │   (右侧)
        │              |              │
        └──────────────┼──────────────┘
                       |
                       ↓
                    -X (后方)
                  PlayerStart
                   (X=-800)
```

### 修改的文件

1. **`room_builder.py`**
   - 修复墙壁位置（前后墙使用 X 轴，左右墙使用 Y 轴）
   - 修复隔断位置（使用 Y 轴）
   - 调整隔断位置为 ±133（均分三个房间）

2. **`lighting_system.py`**
   - 修复点光源位置（使用 Y 轴）
   - 每个房间一个光源

3. **`player_spawner.py`**
   - 修复 PlayerStart 位置（后方中央）
   - 面向前方（+X）

### 房间尺寸

**总尺寸：**
- X 轴（前后）：1800 单位（-900 到 +900）
- Y 轴（左右）：800 单位（-400 到 +400）
- Z 轴（高度）：400 单位（0 到 400）

**每个房间：**
- X 轴：1800 单位（整个长度）
- Y 轴：约 267 单位（800 / 3）
- Z 轴：400 单位（高度）

**隔断位置计算：**
- 总宽度：800 单位
- 每个房间：800 / 3 ≈ 267 单位
- 左隔断：-400 + 267 = -133
- 右隔断：-400 + 534 = +133

### 验证结果

**地图文件：**
- 大小：50.33 KB
- 位置：`Content/Maps/Cosmos_002_Training_World.umap`

**Actors 总数：16 个**
- 8 个房间几何体（地板、天花板、4墙、2隔断）
- 1 个 PlayerStart（后方中央）
- 4 个灯光（1方向光 + 1天空光 + 3点光源）
- 1 个天空球
- 1 个后期处理体积

### 下一步验证

**在编辑器中检查：**
1. 打开 `Cosmos_002_Training_World.umap`
2. 从顶视图（Top View）查看布局
3. 确认墙壁位置正确：
   - 前墙在 +X 方向
   - 后墙在 -X 方向
   - 左墙在 -Y 方向
   - 右墙在 +Y 方向
4. 确认隔断将房间均分为三部分
5. 确认 PlayerStart 在后方中央，面向前方
6. 点击 Play 测试视角

### 参考文档

详细的坐标系说明请参考：`UE5_COORDINATE_SYSTEM.md`
